title: "OMV file 1"
author: "RosaKalish"
output: github_document
========================================================

Load Packages
```{r}
library(tidyverse)
library(lubridate)
library(car)      # John Fox program for his regression text, nice recode command
library(rms)      # Frank Harrell regression modeling strategies package
library(Hmisc)    # Frank Harrell miscellaneous commands package
library(broom)    # Create "tidy" data frames from statistical results
library(popbio)   # Matrix population package, has beautiful logit+histogram plot command
library(tidyverse)
library(data.table)
library(stringr)

```{r}
```
Import and Bind Voter Data 
```{r}
#This link attempts to make the data importable to anyone, however I can not get it to work 

voterfull <- read_tsv('https://www.dropbox.com/s/khywm89j8myn5t0/or_voter_history.zip?dl=0')

#These are the files with correct voting turnout data, however they are still missing registration type, I am not sure where to find that 

file.choose()
votern1 <- read_tsv("/Users/rosa/Desktop/or_voter_history/CD1_VoterHistory_Jan2017.txt")
votern2 <- read_tsv("/Users/rosa/Desktop/or_voter_history/CD2_VoterHistory_Jan2017.txt")
votern3 <- read_tsv("/Users/rosa/Desktop/or_voter_history/CD3_VoterHistory_Jan2017.txt")
votern4 <- read_tsv("/Users/rosa/Desktop/or_voter_history/CD4_VoterHistory_Jan2017.txt")
votern5 <- read_tsv("/Users/rosa/Desktop/or_voter_history/CD5_VoterHistory_Jan2017.txt")

votern_all <- rbind(votern1, votern2, votern3, votern4, votern5)
---------
#These are the voter files I downloaded from Pauls google drive, tho they do not seem to have all the information that I need. 
  
voter1 <- read_tsv("/Users/rosa/Documents/OMV project/data /CD1_VoterList_Jan2017.txt")
voter2 <- read_tsv("/Users/rosa/Documents/OMV project/data /CD2_VoterList_Jan2017.txt")
voter3 <- read_tsv("/Users/rosa/Documents/OMV project/data /CD3_VoterList_Jan2017.txt")
voter4 <- read_tsv("/Users/rosa/Documents/OMV project/data /CD4_VoterList_Jan2017.txt")
voter5 <- read_tsv("/Users/rosa/Documents/OMV project/data /CD5_VoterList_Jan2017.txt")

voter_all <- rbind(voter1, voter2, voter3, voter4, voter5)
head(voter_all) 

```
Tidy Vote File 
```{r}
#Here I select the columns I need. I would like to select the "11/08/2016" file but it will not let me, I think becuase the title is numeric. 
votern_or <- votern_all %>%
  select(VOTER_ID, FIRST_NAME, LAST_NAME, COUNTY, CITY, BIRTH_DATE, STATUS, PARTY_CODE, RES_ADDRESS_1, PRECINCT_NAME, PRECINCT, ZIP_CODE)

# Exluding 11/08/2016 
```
Import Geographic Data
```{r}
#I first import Census tract data, then State Legislative district, then County. 
#file.choose()
census <- read_csv("/Users/rosa/Desktop/SEcensus.csv")

#file.choose()
stateleg <- read_csv("/Users/rosa/Desktop/SEstateleg.csv")

#file.choose()
county <- read_csv("/Users/rosa/Desktop/SEcounty.csv")

#file.choose()
zipcode <- read_csv("/Users/rosa/Desktop/zipcode.csv") %>%
  mutate(Geo_NAME = str_replace_all(Geo_NAME, pattern = "ZCTA5 ", replacement = ""))

# Make note of which zips have "(part)" - For later
part_zips <- zipcode %>%
  filter(grepl("part", Geo_NAME))

# Clear those out
zipcode <- zipcode %>%
    mutate(Geo_NAME = substr(Geo_NAME, 1, 5)) %>%
  rename(total_pop = SE_T003_001,
         male = SE_T003_002,
         female = SE_T003_003)

# Just sex
sex <- zipcode %>%
  select(Geo_NAME, total_pop, male, female)
```

Get at zip code level for Oregon registered voters

```{r}
total_regs <- votern_all %>%
  group_by(ZIP_CODE) %>%
  summarize(count = n())
```

Proportion of registered that voted on Nov 2016

```{r}
prop_voted16 <- votern_all %>%
  group_by(ZIP_CODE) %>%
  summarize(prop_voted = mean(`11/08/2016` == "YES"))
```

Put them together

```{r}
zipcode_data <- inner_join(x = total_regs,
                           y = prop_voted16,
                           by = "ZIP_CODE")

# Join with voter reg aggregated data
sex_reg <- inner_join(x = sex, y = zipcode_data, 
                      by = c("Geo_NAME" = "ZIP_CODE"))


```



Tidy Geographic Data 
```{r}
#Here I would like to seperate the columns into ones with County and tract in seperate columns, but I am not sure how to do that. 

#censust <- census %>%
  #select(Geo_NAME, Geo_COUNTY)

```

 County Join 
```{r}
votern_all2 <- votern_all %>%
  mutate(COUNTY = tolower(COUNTY))
county2 <- county %>%
  mutate(COUNTY = tolower(COUNTY))
join <- inner_join(votern_all2, county2, by = "COUNTY")

#voter_or %>% count(COUNTY)
#voter_or %>% count(COUNTY, PARTY_CODE)
```
Visualize 
```{r}
ggplot(county, aes(x= TotalPopRace, y= PopWhite))+
  geom_line()

ggplot(county, aes(x= PopWhite))+
  geom_bar()+ 
  facet_grid(.~COUNTY)
 

```

